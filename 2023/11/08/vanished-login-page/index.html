<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 【渗透案例】消失的登录页面 · 浮萍's Blog</title><meta name="description" content="【渗透案例】消失的登录页面 - 浮萍"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="search" type="application/opensearchdescription+xml" href="https://fuping.site/atom.xml" title="浮萍's Blog"><script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="浮萍's Blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">所有文章</a></li><li class="nav-list-item"><a href="/tags" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/search" target="_self" class="nav-list-link search"><i class="fa fa-search" aria-hidden="true"></i></a></li></ul></header><main class="container"></main><div class="post"><article class="post-block"><h1 class="post-title">【渗透案例】消失的登录页面</h1><div class="post-info">Nov 8, 2023<span class="categories"><i class="fa fa-bookmark" aria-hidden="true"></i></span><a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" class="post-category">#渗透测试</a></div><div class="post-content"><p><a name="75dc90f7"></a></p>
<h2 id="0x00前言"><a href="#0x00前言" class="headerlink" title="0x00前言"></a>0x00前言</h2><p>在某次测试过程中，遇到了这样一个网站，存在登录页面但却无法直接通过地址栏访问login页面。在 JS 文件中发现了默认密码，同时找到了登录接口，然而密码进行了加密。通过分析JS文件，最终通过两种方式来实现了登录，一种是找到密码的加密方法，一种是让登录接口”重见天日”。</p>
<p><a name="b40fd1a3"></a></p>
<a id="more"></a>
<h2 id="0x01过程"><a href="#0x01过程" class="headerlink" title="0x01过程"></a>0x01过程</h2><p>网站主页都是一些展示的内容，js文件是通过webpack打包的，格式化后大概三十多万行。<br>通过js文件发现了一些接口，其中有些接口存在未授权访问漏洞。而且有一个接口可以查看上传的所有附件信息，其中还包含了用户名。<br><img src="1699372058582-5c199822-230d-4376-b6ee-8f31cbd92640-736620.jpg" alt></p>
<p>通过分析JS文件，发现存在默认密码</p>
<p><img src="1699372058821-56144eb0-ed31-4887-afe0-bb30f8ca6a41-706259.jpg" alt><br><img src="1699372058927-ffdc647f-e9e1-493a-bb2c-db0b08db1717-747883.jpg" alt></p>
<p>而且也找到了登录的接口，一共两个，一个是Login，一个是LoginApp，其中LoginApp不需要验证码。<br><img src="1699372059040-6849ea96-3935-4c00-b426-974803c5e7b5-293000.jpg" alt></p>
<p>目前有登录的接口、一部分用户名（从未授权中获取的），还有系统的默认密码，接下来就是测试那些用户使用了默认密码，可以成功登录。但是从登录接口发现，登录过程中密码采用了<code>_encrypt</code>函数进行加密。<br>大概如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t.prototype._encrypt = <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> D(y.Md5.hashStr(t.toString()).toString())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以猜测首先对密码进行了Md5加密后，又经过了<code>D</code>函数进行加密。接下来可以寻找<code>D</code>函数是如何进行加密的。<br>一般情况下，<code>D</code>函数有如下两种定义的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">D</span>(<span class="params">params</span>)</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">D = <span class="function"><span class="keyword">function</span>(<span class="params">params</span>)</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们可以通过下面的两种正则进行搜索。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D &#x3D; function\(\w\)</span><br><span class="line">function D\(\w\)</span><br></pre></td></tr></table></figure>

<p><img src="1699372059145-537841dc-9236-461f-b79f-73a765cd6531-940044.jpg" alt></p>
<p><img src="1699372059298-02462190-a2f9-476a-b556-05055ba5c855-577260.jpg" alt><br>幸好<code>D</code>函数不多，也没有混淆，经过确认<code>D</code>函数是<code>SHA1</code>加密。<br>而且经过验证，成功找到了几个可以登录的账号。<br><img src="1699372059419-48301f97-2efd-4f5f-84ab-18253f7e8fcf-662464.jpg" alt></p>
<p>登录后，某个接口可以列举所有的用户，包括该用户加密后的密码。<br><img src="1699372059591-f6d4307a-ebe1-4680-8c2b-3a84881072d5-845594.jpg" alt></p>
<p>例如登录admin用户。<br><img src="1699372059758-22b4260b-0100-44f9-a538-ae3f6600c364-719612.jpg" alt></p>
<p>回过头来继续看登录页面，直接浏览器访问<a href="https://test.com/login" target="_blank" rel="noopener">https://test.com/login</a> 时，会重定向到主页。<br><img src="1699372059897-c867ac68-5b91-402f-a981-fa43fb50e575-598074.jpg" alt></p>
<p>通过搜索js文件<br><img src="1699372060047-1ca18d20-91ed-4303-bb10-31126e8ed577-296321.jpg" alt></p>
<p>发现了<code>n.router.navigateByUrl(&quot;/login&quot;)</code>，这是一个用于在前端Web应用中进行路由导航的代码片段。它通常在前端框架或库（如Angular、Vue.js、React等）中使用，用于导航到指定的路由或页面。</p>
<p>当执行它时，应用程序会导航到 <code>/login</code> 路由或页面。<br><img src="1699372060186-b5c0c500-62e6-4946-8d57-e3f0f216bbf2-623137.jpg" alt></p>
<p>因此我们导航加载的位置，然后执行<code>router.navigateByUrl(&quot;/login&quot;)</code>，这里是<code>this.navigateByUrl(&quot;/login&quot;)</code><br>成功的跳转到了登录的页面</p>
<p><img src="1699372060310-e3aae466-1c65-4f55-bf18-5a8d12515579-413915.jpg" alt></p>
<p>通过验证，Login接口密码也是经过了md5后再进行SHA1加密。<br><img src="1699372060424-10c96cfb-a79a-4b7c-bf92-3bd47a4e01a1-410887.jpg" alt></p>
<p><a name="231f1858"></a></p>
<h2 id="0x02总结"><a href="#0x02总结" class="headerlink" title="0x02总结"></a>0x02总结</h2><p>这个网站虽然存在登录页面，但无法直接通过URL访问。通过分析JS代码发现了默认密码，了解了密码加密方式。通过API接口，找到了未授权访问漏洞，获取了用户名，实现了登录。另外通过分析js，可以使用<code>router.navigateByUrl(&quot;/login&quot;)</code>来导航到登录页面，从而让登录页面出现，然后通过登录页面来登录。</p>
</div><p class="post-tags"><i class="fa fa-tags" aria-hidden="true"></i><a href="/tags/js%E9%80%86%E5%90%91/">#js逆向</a><a href="/tags/%E8%B7%AF%E7%94%B1/">#路由</a></p></article></div><footer><div class="paginator"><a href="/2023/03/07/IOS-Jailbreak-Environment/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2023 <a href="https://fuping.site">浮萍</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-103156844-1",'auto');ga('send','pageview');</script><link rel="stylesheet" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" media="screen" type="text/css"><script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script><script>$(function(){$('.datatable').dataTable( {"order": [[ 0, "desc" ]],"iDisplayLength": -1,"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]} );});</script></body></html>