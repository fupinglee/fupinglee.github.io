<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 吾爱破解2025春节红包活动番外篇第三题 · 浮萍's Blog</title><meta name="description" content="吾爱破解2025春节红包活动番外篇第三题 - 浮萍"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="search" type="application/opensearchdescription+xml" href="https://fuping.site/atom.xml" title="浮萍's Blog"><script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="浮萍's Blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">所有文章</a></li><li class="nav-list-item"><a href="/tags" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/search" target="_self" class="nav-list-link search"><i class="fa fa-search" aria-hidden="true"></i></a></li></ul></header><main class="container"></main><div class="post"><article class="post-block"><h1 class="post-title">吾爱破解2025春节红包活动番外篇第三题</h1><div class="post-info">Feb 12, 2025<span class="categories"><i class="fa fa-bookmark" aria-hidden="true"></i></span><a href="/categories/CTF/" class="post-category">#CTF</a></div><div class="post-content"><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>番外篇第三题刚开始是有难度的，玩家会相互干扰，想要获取flag，还是需要靠一点运气的。后面修改了难度，分 IP 抽奖，互相不干扰了。难度就降低了不少。</p>
<a id="more"></a>

<h2 id="0x01-分析"><a href="#0x01-分析" class="headerlink" title="0x01 分析"></a>0x01 分析</h2><p>第三题是抽奖的，地址：<a href="https://2025challenge.52pojie.cn/lottery.html" target="_blank" rel="noopener">https://2025challenge.52pojie.cn/lottery.html</a> ，看一下题目。</p>
<p><img src="01.png" alt="要求"></p>
<p>抽奖算法也给出了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">blockNumber=$(curl -s -H <span class="string">'Content-type: application/json'</span> --data-raw <span class="string">'&#123;"body":&#123;&#125;&#125;'</span> <span class="string">'https://api.upowerchain.com/apis/v1alpha1/statistics/overview'</span> | jq -r <span class="string">'.blockHeight'</span>)</span><br><span class="line">blockHash=$(curl -s -H <span class="string">'Content-type: application/json'</span> --data-raw <span class="string">'&#123;"number":"'</span><span class="variable">$blockNumber</span><span class="string">'"&#125;'</span> <span class="string">'https://api.upowerchain.com/apis/v1alpha1/block/get'</span> | jq -r <span class="string">'.data.blockHash'</span>)</span><br><span class="line">userCount=10001</span><br><span class="line">userIndex=$(python -c <span class="string">"print(<span class="variable">$blockHash</span> % <span class="variable">$userCount</span>)"</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$userIndex</span></span><br></pre></td></tr></table></figure>

<p>以之前中奖的为例，<code>blockNumber=29443498</code>，可以看到</p>
<p> <code>blockHash=0xed10c6b62d163279cfff03e39a8017e303a03d48a6a314d24c47596b998ae30b</code></p>
<p>参与抽奖人数是10071</p>
<p><img src="02.png" alt="案例"></p>
<p>那么我们可以通过计算，获取中奖人的序号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blockHash = <span class="number">0xed10c6b62d163279cfff03e39a8017e303a03d48a6a314d24c47596b998ae30b</span></span><br><span class="line">userCount=<span class="number">10071</span></span><br><span class="line">print(blockHash % userCount)</span><br></pre></td></tr></table></figure>

<p>验证结果是3000。</p>
<p><code>blockNumber</code>在每次开奖前也给出了，那么可以根据<code>blockNumber</code>请求API获取<code>blockHash</code>。知道<code>blockHash</code>后，如果可以控制参与抽奖的人数，那么获奖人员的编号也能够确定了。</p>
<p>所以之前的难度是比较大的，都是真人玩家，不好确定参与人数和位置。后面降低了难度，分IP抽奖，互不干扰。</p>
<p>另外需要注意的是，每次抽奖系统会自动添加 9980 个机器人，所以如果参与抽奖的话，编号是从9980开始的。因此需要找到中奖序号大于等于9980的，才能保证自己中奖。而且满10000人才开奖，所以还要添加虚假的UID，来凑人数。</p>
<h2 id="0x02-解题"><a href="#0x02-解题" class="headerlink" title="0x02 解题"></a>0x02 解题</h2><blockquote>
<p>由于现在答题地址下线，所以以之前已开奖的来模拟答题。找到一个中奖序号大于等于9980的blockNumber。</p>
</blockquote>
<p><img src="03.png" alt="案例"></p>
<p>这里的blockNumber为29439513，假如参与抽奖的人数是10000-10300，主要代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">findWinningUserCount</span>(<span class="params">blockNumber</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取指定区块的哈希</span></span><br><span class="line">            <span class="keyword">const</span> r = <span class="keyword">await</span> fetch(<span class="string">'https://api.upowerchain.com/apis/v1alpha1/block/get'</span>, &#123;</span><br><span class="line">                method: <span class="string">'POST'</span>,</span><br><span class="line">                headers: &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;,</span><br><span class="line">                body: <span class="built_in">JSON</span>.stringify(&#123;<span class="string">"number"</span>: blockNumber.toString()&#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> r.json();</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"\n=== API响应 ==="</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!data || !data.data || !data.data.blockHash) &#123;</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">"无效的API响应:"</span>, data);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">const</span> hash = data.data.blockHash;</span><br><span class="line">            <span class="keyword">const</span> hashWithPrefix = hash.startsWith(<span class="string">'0x'</span>) ? hash : <span class="string">'0x'</span> + hash;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`\n区块哈希: <span class="subst">$&#123;hashWithPrefix&#125;</span>`</span>);</span><br><span class="line">            <span class="comment">//从10000开始尝试不同的userCount</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> userCount = <span class="number">10000</span>; userCount &lt;= <span class="number">10300</span>; userCount++) &#123;</span><br><span class="line">                <span class="keyword">const</span> result = BigInt(hashWithPrefix) % BigInt(userCount);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(result &gt;= <span class="number">9980n</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> position = <span class="built_in">Number</span>(result - <span class="number">9980n</span>);</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">`\n!!! FOUND WINNING COMBINATION !!!`</span>);</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">`Block: <span class="subst">$&#123;blockNumber&#125;</span>`</span>);</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">`Hash: <span class="subst">$&#123;hashWithPrefix&#125;</span>`</span>);</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">`User Count: <span class="subst">$&#123;userCount&#125;</span>`</span>);</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">`Absolute Position: <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">`Relative Position: <span class="subst">$&#123;position&#125;</span>\n`</span>);</span><br><span class="line">                    <span class="keyword">return</span> &#123;position, userCount&#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"\n没有找到合适的参与人数组合"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">`\n[错误] 检查区块 <span class="subst">$&#123;blockNumber&#125;</span> 失败:`</span>);</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"错误详情:"</span>, e);</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"错误堆栈:"</span>, e.stack);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">const</span> blockNumber = <span class="number">29439513</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> findWinningUserCount(blockNumber);</span><br></pre></td></tr></table></figure>



<p><img src="05.png" alt="寻找"></p>
<p>根据计算的结果，答题人需要有10201个，中奖的序号是10067，实际位置是第87。剩余的位置都添加虚假的UID。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">joinMultiple</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> timestamp = <span class="built_in">Math</span>.floor(<span class="built_in">Date</span>.now() / <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">let</span> code = <span class="keyword">await</span> getVerifyCode(timestamp.toString() + <span class="string">"|"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 需要221个UID (10201 - 9980 = 221)</span></span><br><span class="line">    <span class="keyword">const</span> uids = [];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成221个UID，确保自己的UID在第87位</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">221</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i === <span class="number">87</span>) &#123;</span><br><span class="line">            uids.push(<span class="string">"你的UID"</span>);  <span class="comment">// 中奖位置</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            uids.push((<span class="number">200000</span> + i).toString());  <span class="comment">// 其他位置用虚假UID</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`\n=== 开始提交抽奖请求 ===`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`时间戳: <span class="subst">$&#123;timestamp&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`总UID数量: <span class="subst">$&#123;uids.length&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`你的位置: 87\n`</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> uid <span class="keyword">of</span> uids) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> response = <span class="keyword">await</span> fetch(<span class="string">'https://2025challenge.52pojie.cn/api/lottery/join'</span>, &#123;</span><br><span class="line">                method: <span class="string">'POST'</span>,</span><br><span class="line">                headers: &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;,</span><br><span class="line">                body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">                    <span class="string">"timestamp"</span>: timestamp,</span><br><span class="line">                    <span class="string">"uid"</span>: uid,</span><br><span class="line">                    <span class="string">"verify_code"</span>: code</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">const</span> textResponse = <span class="keyword">await</span> response.text();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`UID <span class="subst">$&#123;uid&#125;</span>:`</span>, <span class="built_in">JSON</span>.parse(textResponse));</span><br><span class="line">            &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`UID <span class="subst">$&#123;uid&#125;</span>:`</span>, textResponse);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> setTimeout(r, <span class="number">100</span>));  <span class="comment">// 添加延迟避免请求过快</span></span><br><span class="line">        &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">`Error submitting UID <span class="subst">$&#123;uid&#125;</span>:`</span>, e.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"\n=== 提交完成 ==="</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">joinMultiple();</span><br></pre></td></tr></table></figure>

<p>然后就等开奖即可。这里之所以和实际不一样，是因为参与人数不一样也会导致中奖的序号不一样的。</p>
<p>例如我们将参与人数变动一下，范围为10230-10300，得出的中奖序号是一样的。</p>
<p><img src="06.png" alt="寻找"></p>
<h2 id="0x03总结"><a href="#0x03总结" class="headerlink" title="0x03总结"></a>0x03总结</h2><p>这道题的解题思路比较清晰：通过分析抽奖算法，发现中奖序号是由区块哈希值对参与总人数取模得到的。系统会自动添加 9980 个机器人账号，真实玩家的序号从 9980 开始。在后期分 IP 抽奖的调整下，不同 IP 之间互不干扰，这让解题变得更加可控。</p>
<p>解题步骤主要是：首先通过 API 获取指定区块的哈希值，然后遍历可能的参与总人数（比如 10000-10300），找到一个合适的总人数，使得计算出的中奖序号大于等于 9980。确定好参与总人数后，计算出自己需要在机器人之后的第几个位置（中奖序号减去 9980），然后将自己的 UID 放在这个位置，其他位置用虚假 UID 填充。最后等待开奖即可获得 flag。</p>
</div><p class="post-tags"><i class="fa fa-tags" aria-hidden="true"></i><a href="/tags/52%E7%A0%B4%E8%A7%A3/">#52破解</a><a href="/tags/CTF/">#CTF</a><a href="/tags/writeup/">#writeup</a></p></article></div><footer><div class="paginator"><a href="/2025/01/15/fakelocatioin-fix-journey/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2025 <a href="https://fuping.site">浮萍</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-103156844-1",'auto');ga('send','pageview');</script><link rel="stylesheet" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" media="screen" type="text/css"><script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script><script>$(function(){$('.datatable').dataTable( {"order": [[ 0, "desc" ]],"iDisplayLength": -1,"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]} );});</script></body></html>